<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="no.kantega.projectweb.model">

  <class name="Project" table="projectweb_project">
    <cache usage="read-write"/>
    <id name="id" column="projectId" type="long">
      <generator class="increment"/>
    </id>
    <property name="name"/>
    <property name="code"/>
    <property name="goal"/>
    <property name="status"/>
    <property name="startDate" type="date"/>
    <property name="endDate" type="date"/>
    <property name="estimatedHours" type="float"/>
    <property name="estimatedLeftHours" type="float"/>
    <property name="usedHours" type="float"/>
    <property name="owner"/>
    <property name="leader"/>
    <property name="permissionSchemeId"/>
    <property name="publicProject"/>
    <set name="participants" order-by="participantId">
      <key column="projectId"/>
      <one-to-many class="Participant"/>
    </set>
    <set name="activities" order-by="activityId">
      <key column="projectId"/>
      <one-to-many class="Activity"/>
    </set>
    <set name="documents" order-by="documentId">
      <key column="projectId"/>
      <one-to-many class="Document"/>
    </set>
  </class>

  <class name="Activity" table="projectweb_activity">
    <cache usage="read-write"/>
    <id name="id" column="activityId" type="long">
      <generator class="increment"/>
    </id>
    <property name="title"/>
    <property name="description" length="1000"/>
    <property name="workflowId"/>
    <property name="startDate" type="date"/>
    <property name="endDate" type="date"/>
    <property name="estimatedHours" type="float"/>
    <property name="estimatedLeftHours" type="float"/>
    <property name="usedHours" type="float"/>
    <property name="reporter"/>
    <property name="assignee"/>

    <many-to-one name="project" column="projectId" not-null="true" class="Project"/>
    <many-to-one name="type" column="typeId"  not-null="false" class="ActivityType"/>
    <many-to-one name="priority" column="priorityId"  not-null="true" class="ActivityPriority"/>
    <many-to-one name="status" column="statusId"  not-null="true" class="ActivityStatus"/>
    <many-to-one name="projectPhase" column="projectPhaseId" class="ProjectPhase"/>

    <set name="comments"  order-by="activityCommentId desc" cascade="all-delete-orphan">
      <key column="activityId"/>
      <one-to-many class="ActivityComment"/>
    </set>

    <set name="documents" table="projectweb_activity_document">
      <key column="activityId"/>
      <many-to-many column="documentId" class="Document"/>
    </set>
  </class>

  <class name="ActivityType" table="projectweb_activitytype">
    <cache usage="read-write"/>
    <id name="id" column="activityTypeId" type="long">
      <generator class="increment"/>
    </id>
    <property name="name"/>
  </class>

  <class name="ProjectPhase" table="projectweb_projectphase">
    <cache usage="read-write"/>
    <id name="id" column="projectPhaseId" type="long">
      <generator class="increment"/>
    </id>
    <property name="name"/>
  </class>

  <class name="ActivityPriority" table="projectweb_activitypriorities">
    <cache usage="read-write"/>
     <id name="id" column="activityPriorityId" type="long">
       <generator class="increment"/>
     </id>
     <property name="name"/>
   </class>

  <class name="ActivityStatus" table="projectweb_activitystatuses">
    <cache usage="read-write"/>
    <id name="id" column="activityStatusId" type="long">
      <generator class="increment"/>
    </id>
    <property name="code" not-null="false" unique="true"/>
    <property name="name" unique="true" not-null="false"/>
    <property name="description"/>
  </class>

    <class name="DocumentCategory" table="projectweb_documentcategories">
        <cache usage="read-write"/>
        <id name="id" column="documentCategoryId" type="long">
            <generator class="increment"/>
        </id>
        <property name="name"/>
    </class>

  <class name="ActivityComment" table="projectweb_activitycomment">
    <id name="id" column="activityCommentId" type="long">
      <generator class="increment"/>
    </id>
    <property name="user" column="username"/>
    <property name="text"/>
    <property name="date" column="createdDate"/>
    <many-to-one name="activity" class="Activity" column="activityId" not-null="true"/>
  </class>

    <!--
    <class name="DocumentFolder" table="projectweb_documentfolder">
        <id name="id" column="folderId" type="long">
            <generator class="increment"/>
        </id>
        <property name="title"/>
        <many-to-one name="project" column="projectId" not-null="true" class="Project"/>
        <many-to-one name="parent" column="parentId" not-null="false" class="DocumentFolder"/>
    </class>-->

  <class name="Document" table="projectweb_document">
    <id name="id" column="documentId" type="long">
          <generator class="increment"/>
    </id>
    <property name="title"/>
    <property name="description"/>
    <property name="fileName"/>
    <property name="editDate"/>
    <property name="contentType"/>
    <property name="uploader"/>
    <many-to-one name="documentContent" class="DocumentContent" unique="true" not-null="true" cascade="all" column="documentContentId"/>
    <many-to-one name="category" column="categoryId"  not-null="true" class="DocumentCategory"/>
    <many-to-one name="project" column="projectId" not-null="true" class="Project"/>

    <set name="activities" table="projectweb_activity_document" inverse="true" >
        <key column="documentId"/>
        <many-to-many column="activityId" class="Activity"/>
    </set>
    <!--<many-to-one name="documentFolder" column="folderId" not-null="false" class="DocumentFolder"/>-->
  </class>

  <class name="DocumentContent" table="projectweb_documentcontent">
    <id name="id" column="documentContentId" type="long">
      <generator class="increment"/>
    </id>
    <property name="content" type="binary" length="10000" />
    <property name="contentText" type="text" not-null="false" />
  </class>

  <class name="Participant" table="projectweb_participant">
    <id name="id" column="participantId" type="long">
      <generator class="increment"/>
    </id>
    <many-to-one name="project" class="Project" column="projectId" not-null="true" />
    <property name="user" not-null="true"  column="username"/>
    <set name="roles"  order-by="projectRoleId" table="projectweb_participant_roles">
      <key column="paricipantId"/>
        <many-to-many column="projectRoleId" class="ProjectRole"/>
    </set>
  </class>

  <class name="ProjectRole" table="projectweb_projectrole">
    <id name="id" column="projectRoleId" type="long">
      <generator class="increment"/>
    </id>
    <property name="code" unique="true"/>
    <property name="name"/>
    <property name="description"/>
    <!--<set name="participants"  table="projectweb_participant_roles">
      <key column="projectRoleId"/>
      <many-to-many column="participantId" class="Participant"/>
    </set>-->
  </class>

  <class name="no.kantega.projectweb.permission.scheme.PermissionScheme" table="projectweb_permissionscheme">
    <id name="id" column="permissionSchemeId" type="long">
      <generator class="increment"/>
    </id>
    <property name="name"/>
    <property name="description"/>
    <set name="permissionEntries"  order-by="permissionEntryId">
        <key column="permissionSchemeId"/>
          <one-to-many class="no.kantega.projectweb.permission.scheme.PermissionEntry"/>
      </set>
  </class>

  <class name="no.kantega.projectweb.permission.scheme.PermissionEntry" table="projectweb_permissionentry">
    <id name="id" column="permissionEntryId" type="long">
      <generator class="increment"/>
    </id>
    <property name="permission"/>
    <many-to-one name="permissionScheme" column="permissionSchemeId" not-null="true" class="no.kantega.projectweb.permission.scheme.PermissionScheme"/>
    <set name="roles"  order-by="projectRoleId" table="projectweb_permissionentry_roles">
        <key column="permissionEntryId"/>
          <many-to-many column="projectRoleId" class="ProjectRole"/>
      </set>
  </class>

  <class name="Group" table="projectweb_group">
      <id name="id" column="groupId" type="long">
        <generator class="increment"/>
      </id>
    <property name="name"/>
  </class>

  <class name="GroupMembership" table="projectweb_groupmembership">
      <id name="id" column="membershipId" type="long">
        <generator class="increment"/>
      </id>
    <many-to-one name="group" column="groupId" not-null="true" class="Group"/>
    <property name="user"  column="username"/>
  </class>
</hibernate-mapping>